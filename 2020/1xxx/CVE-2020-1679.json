{
    "CVE_data_meta": {
        "ASSIGNER": "sirt@juniper.net",
        "DATE_PUBLIC": "2020-10-14T16:00:00.000Z",
        "ID": "CVE-2020-1679",
        "STATE": "PUBLIC",
        "TITLE": "Junos OS: PTX/QFX Series: Kernel Routing Table (KRT) queue stuck after packet sampling a malformed packet when the tunnel-observation mpls-over-udp configuration is enabled."
    },
    "affects": {
        "vendor": {
            "vendor_data": [
                {
                    "product": {
                        "product_data": [
                            {
                                "product_name": "Junos OS",
                                "version": {
                                    "version_data": [
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "17.2X75",
                                            "version_value": "17.2X75-D105"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "18.1",
                                            "version_value": "18.1R3-S11"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "18.2",
                                            "version_value": "18.2R3-S5"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "18.2X75",
                                            "version_value": "18.2X75-D420, 18.2X75-D53, 18.2X75-D65"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "18.3",
                                            "version_value": "18.3R2-S4, 18.3R3-S3"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "18.4",
                                            "version_value": "18.4R1-S7, 18.4R2-S5, 18.4R3-S4"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "19.1",
                                            "version_value": "19.1R2-S2, 19.1R3-S2"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "19.2",
                                            "version_value": "19.2R1-S5, 19.2R3"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "19.3",
                                            "version_value": "19.3R2-S3, 19.3R3"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "19.4",
                                            "version_value": "19.4R1-S2, 19.4R2-S1, 19.4R3"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "<",
                                            "version_name": "20.1",
                                            "version_value": "20.1R1-S2, 20.1R2"
                                        },
                                        {
                                            "platform": "PTX, QFX",
                                            "version_affected": "!<",
                                            "version_value": "18.1R1"
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    "vendor_name": "Juniper Networks"
                }
            ]
        }
    },
    "configuration": [
        {
            "lang": "eng",
            "value": "The examples of the configuration stanza affected by this issue are as follows:\n  [services flow-monitoring version9 template <template_name> tunnel-observation mpls-over-udp]\nor\n  [services flow-monitoring version-ipfix template <template_name> tunnel-observation mpls-over-udp]"
        }
    ],
    "data_format": "MITRE",
    "data_type": "CVE",
    "data_version": "4.0",
    "description": {
        "description_data": [
            {
                "lang": "eng",
                "value": "On Juniper Networks PTX and QFX Series devices with packet sampling configured using tunnel-observation mpls-over-udp, sampling of a malformed packet can cause the Kernel Routing Table (KRT) queue to become stuck. KRT is the module within the Routing Process Daemon (RPD) that synchronized the routing tables with the forwarding tables in the kernel. This table is then synchronized to the Packet Forwarding Engine (PFE) via the KRT queue. Thus, when KRT queue become stuck, it can lead to unexpected packet forwarding issues. An administrator can monitor the following command to check if there is the KRT queue is stuck: user@device > show krt state ... Number of async queue entries: 65007 <--- this value keep on increasing. When this issue occurs, the following message might appear in the /var/log/messages: DATE DEVICE kernel: %KERN-3: rt_pfe_veto: Too many delayed route/nexthop unrefs. Op 2 err 55, rtsm_id 5:-1, msg type 2 DATE DEVICE kernel: %KERN-3: rt_pfe_veto: Memory usage of M_RTNEXTHOP type = (0) Max size possible for M_RTNEXTHOP type = (7297134592) Current delayed unref = (60000), Current unique delayed unref = (18420), Max delayed unref on this platform = (40000) Current delayed weight unref = (60000) Max delayed weight unref on this platform= (400000) curproc = rpd This issue affects Juniper Networks Junos OS on PTX/QFX Series: 17.2X75 versions prior to 17.2X75-D105; 18.1 versions prior to 18.1R3-S11; 18.2 versions prior to 18.2R3-S5; 18.2X75 versions prior to 18.2X75-D420, 18.2X75-D53, 18.2X75-D65; 18.3 versions prior to 18.3R2-S4, 18.3R3-S3; 18.4 versions prior to 18.4R1-S7, 18.4R2-S5, 18.4R3-S4; 19.1 versions prior to 19.1R2-S2, 19.1R3-S2; 19.2 versions prior to 19.2R1-S5, 19.2R3; 19.3 versions prior to 19.3R2-S3, 19.3R3; 19.4 versions prior to 19.4R1-S2, 19.4R2-S1, 19.4R3; 20.1 versions prior to 20.1R1-S2, 20.1R2. This issue does not affect Juniper Networks Junos OS prior to 18.1R1."
            }
        ]
    },
    "exploit": [
        {
            "lang": "eng",
            "value": "Juniper SIRT is not aware of any malicious exploitation of this vulnerability."
        }
    ],
    "generator": {
        "engine": "Vulnogram 0.0.9"
    },
    "impact": {
        "cvss": {
            "attackComplexity": "LOW",
            "attackVector": "NETWORK",
            "availabilityImpact": "HIGH",
            "baseScore": 7.5,
            "baseSeverity": "HIGH",
            "confidentialityImpact": "NONE",
            "integrityImpact": "NONE",
            "privilegesRequired": "NONE",
            "scope": "UNCHANGED",
            "userInteraction": "NONE",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
            "version": "3.1"
        }
    },
    "problemtype": {
        "problemtype_data": [
            {
                "description": [
                    {
                        "lang": "eng",
                        "value": "CWE-20 Improper Input Validation"
                    }
                ]
            }
        ]
    },
    "references": {
        "reference_data": [
            {
                "name": "https://kb.juniper.net/JSA11076",
                "refsource": "CONFIRM",
                "url": "https://kb.juniper.net/JSA11076"
            }
        ]
    },
    "solution": [
        {
            "lang": "eng",
            "value": "The following software releases have been updated to resolve this specific issue: Junos OS 17.2X75-D105, 18.1R3-S11, 18.2R3-S5, 18.2X75-D420, 18.2X75-D53, 18.2X75-D65, 18.3R2-S4, 18.3R3-S3, 18.4R1-S7, 18.4R2-S5, 18.4R3-S4, 19.1R2-S2, 19.1R3-S2, 19.2R1-S5, 19.2R3, 19.3R2-S3, 19.3R3, 19.4R1-S2, 19.4R2-S1, 19.4R3, 20.1R1-S2, 20.1R2, 20.2R1, 20.3X75-D10, and all subsequent releases.\n"
        }
    ],
    "source": {
        "advisory": "JSA11076",
        "defect": [
            "1495788"
        ],
        "discovery": "USER"
    },
    "work_around": [
        {
            "lang": "eng",
            "value": "Disable sampling on all the interfaces will prevent the issue from occurring.\n\nIf the device is experiencing the issue, the administrator can perform the follow steps to restore KRT queue:\n1. Disable sampling configuration on this FPC\n  user@device> deactivate chassis fpc<slot-no> sampling-instance <instance-name>\n2. Restart multi-svcs process on this FPC by killing the process. The multi-svcs will get stared  automatically once it gets killed and resume normal processing.\n\n"
        }
    ]
}