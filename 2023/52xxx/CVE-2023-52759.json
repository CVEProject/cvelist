{
    "data_version": "4.0",
    "data_type": "CVE",
    "data_format": "MITRE",
    "CVE_data_meta": {
        "ID": "CVE-2023-52759",
        "ASSIGNER": "cve@kernel.org",
        "STATE": "PUBLIC"
    },
    "description": {
        "description_data": [
            {
                "lang": "eng",
                "value": "In the Linux kernel, the following vulnerability has been resolved:\n\ngfs2: ignore negated quota changes\n\nWhen lots of quota changes are made, there may be cases in which an\ninode's quota information is increased and then decreased, such as when\nblocks are added to a file, then deleted from it. If the timing is\nright, function do_qc can add pending quota changes to a transaction,\nthen later, another call to do_qc can negate those changes, resulting\nin a net gain of 0. The quota_change information is recorded in the qc\nbuffer (and qd element of the inode as well). The buffer is added to the\ntransaction by the first call to do_qc, but a subsequent call changes\nthe value from non-zero back to zero. At that point it's too late to\nremove the buffer_head from the transaction. Later, when the quota sync\ncode is called, the zero-change qd element is discovered and flagged as\nan assert warning. If the fs is mounted with errors=panic, the kernel\nwill panic.\n\nThis is usually seen when files are truncated and the quota changes are\nnegated by punch_hole/truncate which uses gfs2_quota_hold and\ngfs2_quota_unhold rather than block allocations that use gfs2_quota_lock\nand gfs2_quota_unlock which automatically do quota sync.\n\nThis patch solves the problem by adding a check to qd_check_sync such\nthat net-zero quota changes already added to the transaction are no\nlonger deemed necessary to be synced, and skipped.\n\nIn this case references are taken for the qd and the slot from do_qc\nso those need to be put. The normal sequence of events for a normal\nnon-zero quota change is as follows:\n\ngfs2_quota_change\n   do_qc\n      qd_hold\n      slot_hold\n\nLater, when the changes are to be synced:\n\ngfs2_quota_sync\n   qd_fish\n      qd_check_sync\n         gets qd ref via lockref_get_not_dead\n   do_sync\n      do_qc(QC_SYNC)\n         qd_put\n\t    lockref_put_or_lock\n   qd_unlock\n      qd_put\n         lockref_put_or_lock\n\nIn the net-zero change case, we add a check to qd_check_sync so it puts\nthe qd and slot references acquired in gfs2_quota_change and skip the\nunneeded sync."
            }
        ]
    },
    "problemtype": {
        "problemtype_data": [
            {
                "description": [
                    {
                        "lang": "eng",
                        "value": "n/a"
                    }
                ]
            }
        ]
    },
    "affects": {
        "vendor": {
            "vendor_data": [
                {
                    "vendor_name": "Linux",
                    "product": {
                        "product_data": [
                            {
                                "product_name": "Linux",
                                "version": {
                                    "version_data": [
                                        {
                                            "version_affected": "<",
                                            "version_name": "1da177e4c3f4",
                                            "version_value": "1c28dace6601"
                                        },
                                        {
                                            "version_value": "not down converted",
                                            "x_cve_json_5_version_data": {
                                                "versions": [
                                                    {
                                                        "version": "4.14.331",
                                                        "lessThanOrEqual": "4.14.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "4.19.300",
                                                        "lessThanOrEqual": "4.19.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "5.4.262",
                                                        "lessThanOrEqual": "5.4.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "5.10.202",
                                                        "lessThanOrEqual": "5.10.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "5.15.140",
                                                        "lessThanOrEqual": "5.15.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "6.1.64",
                                                        "lessThanOrEqual": "6.1.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "6.5.13",
                                                        "lessThanOrEqual": "6.5.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "6.6.3",
                                                        "lessThanOrEqual": "6.6.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "6.6.57",
                                                        "lessThanOrEqual": "6.6.*",
                                                        "status": "unaffected",
                                                        "versionType": "custom"
                                                    },
                                                    {
                                                        "version": "6.7",
                                                        "lessThanOrEqual": "*",
                                                        "status": "unaffected",
                                                        "versionType": "original_commit_for_fix"
                                                    }
                                                ],
                                                "defaultStatus": "affected"
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        }
    },
    "references": {
        "reference_data": [
            {
                "url": "https://git.kernel.org/stable/c/1c28dace66015b675a343b89b0c87abbfda05ff4",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/1c28dace66015b675a343b89b0c87abbfda05ff4"
            },
            {
                "url": "https://git.kernel.org/stable/c/b4deec69fe32b58dc5fb4ace52456ece85b75561",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/b4deec69fe32b58dc5fb4ace52456ece85b75561"
            },
            {
                "url": "https://git.kernel.org/stable/c/2bb42a27a92ff3984c9fa5fbe128eced3ea693f2",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/2bb42a27a92ff3984c9fa5fbe128eced3ea693f2"
            },
            {
                "url": "https://git.kernel.org/stable/c/2a054b87a1b799b391e578597a42ee6e57a987ae",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/2a054b87a1b799b391e578597a42ee6e57a987ae"
            },
            {
                "url": "https://git.kernel.org/stable/c/5bfda356e903633d16ae1bac1ee38364e12628a3",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/5bfda356e903633d16ae1bac1ee38364e12628a3"
            },
            {
                "url": "https://git.kernel.org/stable/c/53fc16c1ad84f5467ec24341670b63aa759335d3",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/53fc16c1ad84f5467ec24341670b63aa759335d3"
            },
            {
                "url": "https://git.kernel.org/stable/c/212f112fe5e90e98eb8d48585682880dae139f4c",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/212f112fe5e90e98eb8d48585682880dae139f4c"
            },
            {
                "url": "https://git.kernel.org/stable/c/119565e566f91ff3588ffcd5812f0c8061586c6b",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/119565e566f91ff3588ffcd5812f0c8061586c6b"
            },
            {
                "url": "https://git.kernel.org/stable/c/50e33567bc4a1c4ed79a1d289fe93c9a26491848",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/50e33567bc4a1c4ed79a1d289fe93c9a26491848"
            },
            {
                "url": "https://git.kernel.org/stable/c/4c6a08125f2249531ec01783a5f4317d7342add5",
                "refsource": "MISC",
                "name": "https://git.kernel.org/stable/c/4c6a08125f2249531ec01783a5f4317d7342add5"
            }
        ]
    },
    "generator": {
        "engine": "bippy-c9c4e1df01b2"
    }
}